-- Elimina/crea la BD
DROP DATABASE IF EXISTS banca;
CREATE DATABASE banca CHARACTER SET = 'utf8mb4' COLLATE = 'utf8mb4_unicode_ci';
USE banca;

-- Tabla Cliente
CREATE TABLE Cliente (
  id_cliente INT AUTO_INCREMENT PRIMARY KEY,
  nombre VARCHAR(255),
  tipo_de_identificacion VARCHAR(100),
  numero_documento VARCHAR(100) UNIQUE,
  telefono VARCHAR(50),
  correo VARCHAR(255)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;

-- Tabla Informacion (1:1 con Cliente)
CREATE TABLE Informacion (
  id_informacion INT AUTO_INCREMENT PRIMARY KEY,
  id_cliente INT NOT NULL UNIQUE, -- 1:1 con Cliente
  nombre_completo VARCHAR(255),
  tipo_documento VARCHAR(100),
  numero_documento VARCHAR(100),
  lugar_expedicion VARCHAR(255),
  fecha_expedicion DATE,
  ciudad_nacimiento VARCHAR(150),
  fecha_nacimiento DATE,
  nacionalidad VARCHAR(100),
  genero VARCHAR(50),
  estado_civil VARCHAR(50),
  grupo_etnico VARCHAR(100),
  CONSTRAINT fk_informacion_cliente FOREIGN KEY (id_cliente) REFERENCES Cliente(id_cliente) ON DELETE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;

-- Tabla Contacto (1:1 con Cliente)
CREATE TABLE Contacto (
  id_contacto INT AUTO_INCREMENT PRIMARY KEY,
  id_cliente INT NOT NULL UNIQUE, -- 1:1 con Cliente
  direccion_residencia VARCHAR(255),
  barrio VARCHAR(100),
  ciudad VARCHAR(100),
  departamento VARCHAR(100),
  pais VARCHAR(100),
  celular VARCHAR(50),
  correo VARCHAR(255),
  CONSTRAINT fk_contacto_cliente FOREIGN KEY (id_cliente) REFERENCES Cliente(id_cliente) ON DELETE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;

-- Tabla Actividad_Economica (1:1 con Cliente)
CREATE TABLE Actividad_Economica (
  id_actividad_economica INT AUTO_INCREMENT PRIMARY KEY,
  id_cliente INT NOT NULL UNIQUE, -- 1:1 con Cliente
  profesion VARCHAR(150),
  ocupacion VARCHAR(150),
  detalle_actividad VARCHAR(255),
  codigo_ciiu VARCHAR(100),
  n_empleados INT,
  CONSTRAINT fk_actividad_cliente FOREIGN KEY (id_cliente) REFERENCES Cliente(id_cliente) ON DELETE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;

-- Tabla Informacion_Laboral (1:1 con Cliente)
CREATE TABLE Informacion_Laboral (
  id_informacion_laboral INT AUTO_INCREMENT PRIMARY KEY,
  id_cliente INT NOT NULL UNIQUE, -- 1:1 con Cliente
  nombre_empresa VARCHAR(255),
  direccion VARCHAR(255),
  barrio VARCHAR(100),
  ciudad VARCHAR(100),
  departamento VARCHAR(100),
  pais VARCHAR(100),
  telefono VARCHAR(50),
  extension VARCHAR(20),
  celular VARCHAR(50),
  correo VARCHAR(255),
  CONSTRAINT fk_laboral_cliente FOREIGN KEY (id_cliente) REFERENCES Cliente(id_cliente) ON DELETE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;

-- Tabla Informacion_Financiera (1:1 con Cliente)
CREATE TABLE Informacion_Financiera (
  id_informacion_financiera INT AUTO_INCREMENT PRIMARY KEY,
  id_cliente INT NOT NULL UNIQUE, -- 1:1 con Cliente
  ingresos_mensuales DECIMAL(15,2),
  otros_ingresos DECIMAL(15,2),
  total_activos DECIMAL(18,2),
  total_pasivos DECIMAL(18,2),
  total_egresos DECIMAL(18,2),
  ventas_anuales DECIMAL(18,2),
  fecha_cierre_ventas DATE,
  CONSTRAINT fk_financiera_cliente FOREIGN KEY (id_cliente) REFERENCES Cliente(id_cliente) ON DELETE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;

-- Tabla Informacion_Adicional (1:1 con Cliente)
CREATE TABLE Informacion_Adicional (
  id_informacion_adicional INT AUTO_INCREMENT PRIMARY KEY,
  id_cliente INT NOT NULL UNIQUE, -- 1:1 con Cliente
  informacion_pep VARCHAR(255),
  informacion_tributaria VARCHAR(255),
  informacion_fatca_crs VARCHAR(255),
  CONSTRAINT fk_adicional_cliente FOREIGN KEY (id_cliente) REFERENCES Cliente(id_cliente) ON DELETE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;

-- Tabla Cuenta de Ahorro
CREATE TABLE Cuenta_Ahorro (
  id_cuenta INT AUTO_INCREMENT PRIMARY KEY,
  numero_cuenta VARCHAR(100) NOT NULL UNIQUE,
  saldo DECIMAL(18,2) DEFAULT 0,
  estado VARCHAR(50),
  fecha_apertura DATE,
  id_cliente INT UNIQUE, -- según diagrama: relación 1:1 con Cliente
  CONSTRAINT fk_cuenta_cliente FOREIGN KEY (id_cliente) REFERENCES Cliente(id_cliente) ON DELETE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;

-- Tabla Usuarios (empleados del banco)
CREATE TABLE Rol (
  id_rol INT AUTO_INCREMENT PRIMARY KEY,
  nombre_rol VARCHAR(150)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;

CREATE TABLE Usuarios (
  id_usuario INT AUTO_INCREMENT PRIMARY KEY,
  codigo VARCHAR(100),
  contrasena VARCHAR(255),
  id_rol INT,
  CONSTRAINT fk_usuario_rol FOREIGN KEY (id_rol) REFERENCES Rol(id_rol) ON DELETE SET NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;

-- Tabla Permisos
CREATE TABLE Permisos (
  id_permisos INT AUTO_INCREMENT PRIMARY KEY,
  tipo_permiso VARCHAR(150)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;

-- Tabla asociativa Rol <-> Permisos (N:M)
CREATE TABLE Rol_Permisos (
  id_rol INT NOT NULL,
  id_permisos INT NOT NULL,
  PRIMARY KEY (id_rol, id_permisos),
  CONSTRAINT fk_rp_rol FOREIGN KEY (id_rol) REFERENCES Rol(id_rol) ON DELETE CASCADE,
  CONSTRAINT fk_rp_permiso FOREIGN KEY (id_permisos) REFERENCES Permisos(id_permisos) ON DELETE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;

-- Tabla asociativa Usuarios <-> Cuenta (gestiona) con fecha_gestion
CREATE TABLE Usuario_Cuenta (
  id_usuario_cuenta INT AUTO_INCREMENT PRIMARY KEY,
  id_cuenta INT NOT NULL,
  id_usuario INT NOT NULL,
  estado varchar (20) default 'inactiva',
  fecha_gestion DATETIME,
  CONSTRAINT fk_uc_cuenta FOREIGN KEY (id_cuenta) REFERENCES Cuenta_Ahorro(id_cuenta) ON DELETE CASCADE,
  CONSTRAINT fk_uc_usuario FOREIGN KEY (id_usuario) REFERENCES Usuarios(id_usuario) ON DELETE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;

-- Tabla Movimiento
CREATE TABLE Movimiento (
  id_movimiento INT AUTO_INCREMENT PRIMARY KEY,
  id_cuenta INT NOT NULL,
  tipo_movimiento VARCHAR(50),
  fecha_movimiento DATETIME,
  monto DECIMAL(18,2),
  CONSTRAINT fk_mov_cuenta FOREIGN KEY (id_cuenta) REFERENCES Cuenta_Ahorro(id_cuenta) ON DELETE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;

-- Índices útiles (opcionales)
CREATE INDEX idx_cliente_numdoc ON Cliente(numero_documento);
CREATE INDEX idx_cuenta_num ON Cuenta_Ahorro(numero_cuenta);
CREATE INDEX idx_mov_fecha ON Movimiento(fecha_movimiento);


